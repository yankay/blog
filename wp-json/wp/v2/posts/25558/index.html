{"id":25558,"date":"2010-01-20T14:48:06","date_gmt":"2010-01-20T06:48:06","guid":{"rendered":"http:\/\/www.kaiyannju.cn\/?p=25558"},"modified":"2010-01-20T14:48:06","modified_gmt":"2010-01-20T06:48:06","slug":"jpa2%e5%88%9d%e8%af%95","status":"publish","type":"post","link":"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/","title":{"rendered":"JPA2\u521d\u8bd5"},"content":{"rendered":"<p>JPA\u662fJava Persistence API\u7684\u7b80\u79f0\u3002JPA\u901a\u8fc7\u6ce8\u89e3\u63cf\u8ff0\u5bf9\u8c61\uff0d\u5173\u7cfb\u8868\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5e76\u5c06\u8fd0\u884c\u671f\u7684\u5b9e\u4f53\u5bf9\u8c61\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93\u4e2d\u3002\u53ef\u4ee5JPA1.0\u662fJava5\u7684\u6807\u51c6\uff0cJPA2.0\u662fJava6\u7684\u6807\u51c6\u3002JPA2.0\u57282009-12-10\u6b63\u5f0f\u53d1\u5e03\uff0c\u4ed6\u53ea\u662f\u6807\u51c6\uff0c\u6240\u4ee5\u53ea\u6709\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0\u3002\u76ee\u524d\uff0c\u611f\u89c9\u6bd4\u8f83\u6b63\u89c4\u7684\u5b9e\u73b0\u662fEclipseLink,Hibernate\u5373\u5c06\u652f\u6301\u3002<br \/>\nJPA1.0\u7b80\u76f4\u662f\u73a9\u5177\uff0c\u7b80\u6d01\u662f\u5f88\u7b80\u6d01\uff0c\u4f46\u662f\u529f\u80fd\u5b9e\u5728\u6709\u70b9\u5c11\uff0c\u770b\u4e86JPA2.0\u7684\u6539\u8fdb\u4f60\u5c31\u77e5\u9053\u4e86\uff0c\u6211\u60f3\u8981\u7684\u4ed6\u90fd\u6709\u4e86\u3002<br \/>\nJPA2.0\u7684\u6539\u8fdb\uff1a<\/p>\n<ul>\n<li>\u652f\u6301\u901a\u8fc7\u4f7f\u7528 @ElementCollection \u6807\u6ce8\u6765\u589e\u5f3a collections\uff0c maps \u548c lists\uff08 \u8fd9\u91cc\u4e0d\u662f\u6307\u5b9e\u4f53\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb \uff09 \u96c6\u5408\uff0c\u652f\u6301 map \u7684\u5355\u5411 one-to-many \u5173\u8054 \uff08JPA1.0 \u53ea\u5141\u8bb8\u53cc\u5411 one-to-many \u5173\u8054 \uff09<\/li>\n<li>\u589e\u52a0\u4e86 Criteria API<\/li>\n<li>\u589e\u52a0\u4e8c\u7ea7\u7f13\u5b58\u652f\u6301<\/li>\n<\/ul>\n<p>\u8fd9\u662f\u6211\u8ba4\u4e3a\u6700\u6709\u7528\u7684\u4e09\u4e2a\u3002<\/p>\n<p>\u5e9f\u8bdd\u4e0d\u8bf4\u4e86\uff0c\u770b\u5177\u4f53\u7684\uff0c\u6211\u662f\u7528\u8fd8\u6ca1\u6709\u6b63\u5f0f\u53d1\u5e03\u7684Hibernate3.5\u5b9e\u73b0\u7684\u3002\u6709Maven\u6784\u5efa\u7684\u3002<a href=\"http:\/\/www.yankay.com\/wp-content\/uploads\/2010\/01\/s3hTemplate.zip\">\u4e0b\u8f7d<\/a><\/p>\n<p>\u5148\u770b\u770b\u6d4b\u8bd5\uff1a<\/p>\n<pre lang=\"java\">public class UserDaoTest extends TestCaseBase {\n\t@Resource\n\tprivate UserDao userDao;\n\n\tpublic void testPost() {\n\t\tUser user = new User();\n\t\tuser.setUsername(\"ir\");\n\t\tuser.setPassword(\"ir\");\n\t\tList roles = new ArrayList();\n\t\troles.add(User.ROLE_STUDENT);\n\t\troles.add(User.ROLE_TEACHER);\n\t\tuser.setRoles(roles);\n\t\tuserDao.post(user);\n\t}\n\n\t@Test\n\tpublic void testGet() throws Exception {\n\t\ttestPost();\/\/ \u5b58\u50a8\u4e00\u4e2a\u540d\u53eb\"ir\"\u7684\u7528\u6237\n\t\tUser user = userDao.get(\"ir\");\/\/ \u53d6\u51fa\u4e00\u4e2a\u540d\u53eb\"ir\"\u7684\u7528\u6237\n\t\tlog.debug(BeanUtils.describe(user));\n\t\t\/**\n\t\t * \u7ed3\u679c\u4e3a\uff1a{id=1, username=ir, roles=ROLE_STUDENT, class=class\n\t\t * org.jerrymouse.User, password=ir}\n\t\t *\/\n\t\tlog.debug(user.getRoles());\/\/ \u7ed3\u679c\u4e3a\uff1a[ROLE_STUDENT, ROLE_TEACHER]\n\t}\n}<\/pre>\n<p>\u91cc\u9762\u53ea\u6709\u4e00\u4e2a\u7528\u4f8b<strong>testGet<\/strong>\uff0c\u4e00\u5b58\u4e00\u53d6\uff0c\u4e00\u770b\u5c31\u660e\u767d\u3002\u90a3\u4e2aUser\u548cUserDao\u662f\u600e\u4e48\u56de\u4e8b\u5462\uff1f<\/p>\n<pre lang=\"java\">@Entity\npublic class User implements CopyAble {\n\tpublic static String ROLE_STUDENT = \"ROLE_STUDENT\";\n\tpublic static String ROLE_TEACHER = \"ROLE_TEACHER\";\n\n\t@Id\n\t@Column(nullable = false)\n\t@GeneratedValue(strategy = GenerationType.AUTO)\n\tprivate Integer id;\/\/\u4e3b\u952e\n\n\tprivate String password;\n\n\t@ElementCollection(fetch = FetchType.EAGER)\n\tprivate List roles;\/\/\u4e00\u5bf9\u591a\u96c6\u5408\n\n\t@Column(unique = true)\n\tprivate String username;\n\n\/\/get and set\n}<\/pre>\n<p>\u5982\u679c\u662fJPA1.0\u5fc5\u987b\u518d\u5199\u4e00\u4e2aRole\u7c7b\u3002<\/p>\n<pre lang=\"java\">@Component\npublic class UserDao extends DatabaseSupport {\n\tprivate static Log log = LogFactory.getLog(UserDao.class);\n\n\tpublic User get(String username) {\n\t\tUser user = null;\n\t\tEntityManager em = null;\n\t\ttry {\n\t\t\tem = getEntityManager();\n\t\t\t\/**\n\t\t\t * \u6784\u9020\u4e00\u4e2aQuery\n\t\t\t *\/\n\t\t\tCriteriaBuilder cb = em.getCriteriaBuilder();\n\t\t\tCriteriaQuery query = cb.createQuery(User.class);\n\t\t\tRoot emp = query.from(User.class);\n\t\t\tquery = query.select(emp).where(\n\t\t\t\t\tcb.equal(emp.get(\"username\"), username));\n\t\t\t\/**\n\t\t\t * \u8fd0\u884c\u4e4b\n\t\t\t *\/\n\t\t\tuser = em.createQuery(query).getSingleResult();\n\t\t} catch (NoResultException e) {\n\t\t\treturn null;\n\t\t} finally {\n\t\t\tem.close();\n\t\t}\n\t\treturn user;\n\t}\n\n\t@Override\n\tpublic Class getType() {\n\t\treturn User.class;\n\t}<\/pre>\n<p>\u7ec8\u4e8e\u53ef\u4ee5\u4e0d\u5199\u4e00\u884cSQL\u5c31\u80fd\u5b9e\u73b0\u6570\u636e\u5e93\u67e5\u8be2\u4e86\uff0c\u8fd9\u4e00\u70b9\u770b\u4f3c\u5bfb\u5e38\u5176\u5b9e\u5f88\u91cd\u8981\uff0c\u5b83\u53ef\u4ee5\u5728\u91cd\u6784\u65f6\u5927\u5927\u51cf\u5c11\u9519\u8bef\u7684\u6570\u91cf\u3002<br \/>\nJPA2.0\u7684Criteria\u529f\u80fd\u8fdc\u8fdc\u4e0d\u9650\u4e8e\u6b64\uff0c\u6587\u6863\u4e2d\u6709\u4ecb\u7ecd\u3002<\/p>\n<p>\u5bf9\u4e86\uff0c\u63a8\u8350\u4e00\u672c\u975e\u5e38\u597d\u7684JPA\u8bfb\u7269<\/p>\n<div style=\"width: 310px\" class=\"wp-caption alignnone\"><a href=\"http:\/\/download.csdn.net\/source\/1864059\"><img loading=\"lazy\" decoding=\"async\" class=\" \" title=\"Pro JPA 2: Mastering the Java Persistence API\" src=\"http:\/\/www.yankay.com\/wp-content\/uploads\/2010\/02\/hpaA7.jpg\" alt=\"Pro JPA 2: Mastering the Java Persistence API\" width=\"300\" height=\"371\" \/><\/a><p class=\"wp-caption-text\">Pro JPA 2: Mastering the Java Persistence API<\/p><\/div>\n","protected":false},"excerpt":{"rendered":"<p>JPA\u662fJava Persistence API\u7684\u7b80\u79f0\u3002JPA\u901a\u8fc7\u6ce8\u89e3\u63cf\u8ff0\u5bf9\u8c61\uff0d\u5173\u7cfb\u8868\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5e76\u5c06\u8fd0\u884c\u671f\u7684 [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v16.4 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>JPA2\u521d\u8bd5 - \u6211\u81ea\u7136<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"http:\/\/yankay.com\/jpa2\u521d\u8bd5\/\" \/>\n<meta property=\"og:locale\" content=\"zh_CN\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"JPA2\u521d\u8bd5 - \u6211\u81ea\u7136\" \/>\n<meta property=\"og:description\" content=\"JPA\u662fJava Persistence API\u7684\u7b80\u79f0\u3002JPA\u901a\u8fc7\u6ce8\u89e3\u63cf\u8ff0\u5bf9\u8c61\uff0d\u5173\u7cfb\u8868\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5e76\u5c06\u8fd0\u884c\u671f\u7684 [&hellip;]\" \/>\n<meta property=\"og:url\" content=\"http:\/\/yankay.com\/jpa2\u521d\u8bd5\/\" \/>\n<meta property=\"og:site_name\" content=\"\u6211\u81ea\u7136\" \/>\n<meta property=\"article:published_time\" content=\"2010-01-20T06:48:06+00:00\" \/>\n<meta property=\"og:image\" content=\"http:\/\/www.yankay.com\/wp-content\/uploads\/2010\/02\/hpaA7.jpg\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:label1\" content=\"\u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\" \/>\n\t<meta name=\"twitter:data1\" content=\"1\u5206\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebSite\",\"@id\":\"http:\/\/yankay.com\/#website\",\"url\":\"http:\/\/yankay.com\/\",\"name\":\"\\u6211\\u81ea\\u7136\",\"description\":\"\\u989c\\u5f00\\u7684\\u535a\\u5ba2\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"http:\/\/yankay.com\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"zh-CN\"},{\"@type\":\"ImageObject\",\"@id\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/#primaryimage\",\"inLanguage\":\"zh-CN\",\"url\":\"http:\/\/www.yankay.com\/wp-content\/uploads\/2010\/02\/hpaA7.jpg\",\"contentUrl\":\"http:\/\/www.yankay.com\/wp-content\/uploads\/2010\/02\/hpaA7.jpg\"},{\"@type\":\"WebPage\",\"@id\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/#webpage\",\"url\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/\",\"name\":\"JPA2\\u521d\\u8bd5 - \\u6211\\u81ea\\u7136\",\"isPartOf\":{\"@id\":\"http:\/\/yankay.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/#primaryimage\"},\"datePublished\":\"2010-01-20T06:48:06+00:00\",\"dateModified\":\"2010-01-20T06:48:06+00:00\",\"author\":{\"@id\":\"http:\/\/yankay.com\/#\/schema\/person\/f52d918e9bfa51c4454172c2caa7704f\"},\"breadcrumb\":{\"@id\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/#breadcrumb\"},\"inLanguage\":\"zh-CN\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"item\":{\"@type\":\"WebPage\",\"@id\":\"http:\/\/yankay.com\/\",\"url\":\"http:\/\/yankay.com\/\",\"name\":\"\\u9996\\u9875\"}},{\"@type\":\"ListItem\",\"position\":2,\"item\":{\"@id\":\"http:\/\/yankay.com\/jpa2%e5%88%9d%e8%af%95\/#webpage\"}}]},{\"@type\":\"Person\",\"@id\":\"http:\/\/yankay.com\/#\/schema\/person\/f52d918e9bfa51c4454172c2caa7704f\",\"name\":\"yankay\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"http:\/\/yankay.com\/#personlogo\",\"inLanguage\":\"zh-CN\",\"url\":\"http:\/\/1.gravatar.com\/avatar\/426bb830224c1471011d92a830a6ed4f?s=96&d=wavatar&r=g\",\"contentUrl\":\"http:\/\/1.gravatar.com\/avatar\/426bb830224c1471011d92a830a6ed4f?s=96&d=wavatar&r=g\",\"caption\":\"yankay\"},\"sameAs\":[\"http:\/\/47.100.65.109\"],\"url\":\"http:\/\/yankay.com\/author\/yankay\/\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/posts\/25558"}],"collection":[{"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/comments?post=25558"}],"version-history":[{"count":0,"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/posts\/25558\/revisions"}],"wp:attachment":[{"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/media?parent=25558"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/categories?post=25558"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/yankay.com\/wp-json\/wp\/v2\/tags?post=25558"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}